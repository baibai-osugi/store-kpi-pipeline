name: daily-dummy

on:
  schedule:
    - cron: '10 16 * * *'  # JST 01:10（UTC 16:10） ※好きに変更OK
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Auth to Google Cloud (WIF)
        uses: google-github-actions/auth@v2
        with:
          workload_identity_provider: ${{ secrets.GCP_WIF_PROVIDER }}
          service_account: ${{ secrets.GCP_SERVICE_ACCOUNT_EMAIL }}

      - name: Install deps
        run: npm ci

      - name: Run daily dummy insert
        run: npm run run:daily:dummy
        env:
          BQ_PROJECT: store-kpi
          BQ_DATASET: app_kpi
          BQ_TABLE_APPS: apps
          BQ_TABLE_DAILY: downloads_daily
